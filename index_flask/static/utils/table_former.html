<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="keywords" content="python web application" />
  <meta name="description" content="flask web application" />
  <link href="/favicon.ico" type="image/ico" rel="shortcut icon" />
  <title>Table former</title>

  <link href="/external/jquery-ui/jquery-ui.min.css" rel="stylesheet" />
  <script src="/external/jquery-ui/external/jquery/jquery.js"></script>
  <script src="/external/jquery-ui/jquery-ui.min.js"></script>

  <link href="/external/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
  <script src="/external/bootstrap/js/bootstrap.min.js"></script>

  <link href="/external/jquery.tablesorter/default.css" rel="stylesheet" />
  <script src="/external/jquery.tablesorter/jquery.tablesorter.min.js"></script>

  <link href="/external/highlight/highlight.css" rel="stylesheet" />
  <script src="/external/highlight/highlight.js"></script>

  <script src="/external/string.format-1.0.packed.js"></script>
  <script src="/external/jquery.json-2.3.min.js"></script>

  <link href="/debug/default.css" rel="stylesheet" />
  <script src="/debug/debug.js"></script>
  <script src="/debug/jquery-debug.js"></script>

  <link href="/css/default.css" rel="stylesheet" />
  <script src="/js/view.js"></script>

  <script src="/j2/j2.js"></script>

  <style>

    .blue_frame {
      border: 1px solid #00f;
      padding: 5px;
      overflow: auto;
    }

    .green_frame {
      border: 1px solid #0f0;
      padding: 5px;
      overflow: auto;
    }

    .ok {
      background-color: #ddffdd;
    }

    .warning {
      background-color: #ffffdd;
    }

    .error {
      background-color: #ffdddd;
    }

  </style>


  <script type="text/javascript">


    function create_table( str ) {
      str = str.replace(/(\r\n|\r)/gm, '\n');

      var buffer = '';

      var quoted = false;
      var quoted2 = false;

      for (i=0; i<str.length; i++) {
        var ch = str.charAt(i);
        if (ch == '"') {
          if (quoted2) {
            buffer += '"';
            quoted2 = false;
          } else if (quoted)
            quoted2 = true;
          else
            quoted = true;
        } else if (ch == '\n' && quoted)
          buffer += '<br />';
        else {
          if (quoted2)
            quoted = quoted2 = false;
          buffer += ch;
        }
      }

      buffer = buffer.replace(/\n/gm, '</td></tr><tr><td>');
      buffer = buffer.replace(/\t/g, '</td><td>');
      buffer = '<tr><td>' + buffer + '</td></tr>';

      return buffer;
    } // function


    jQuery( function($) {


      var table1 = $('table#table1');


      $("label#input_data").click( function(event) {
        $("textarea#input_data")
          .val('')
          .focus();
        table1.text('');
      } );


      var f = function() {
        var str = $('textarea#input_data').val();
        if (str.length) {
          var buffer = create_table(str);
          table1.html(buffer);

          // input#delete_empty_cols
          if ($('input#delete_empty_cols').prop('checked')) {
            var cols = $("tr:first td", table1).length;
            for (var i=cols; i; i--) {
              if ($("td:nth-child(" + i + "):empty", table1).length ==
                  $("td:nth-child(" + i + ")", table1).length)
                $("td:nth-child(" + i + ")", table1).remove();
            }
          }

          // input#delete_empty_rows
          if ($('input#delete_empty_rows').prop('checked'))
            $('tr', table1).each(function() {
              if (!$.trim($(this).text()))
                $(this).remove();
            });
        } else
          table1.text('');
      } // function

      $('textarea#input_data').bind('input propertychange', f);
      $('input#delete_empty_rows').change(f);
      $('input#delete_empty_cols').change(f);


    } );


  </script>

</head>
<body>

  <div>
    <label for="input_data" id="input_data">Text:</label><br />
    <textarea id="input_data" class="blue_frame" style="width: 80%;"></textarea>
  </div>

  <input id="delete_empty_rows" type="checkbox" />
  <label for="delete_empty_rows">Удалять пустые строки</label>
  <br />

  <input id="delete_empty_cols" type="checkbox" />
  <label for="delete_empty_cols">Удалять пустые колонки</label>
  <br />
  <br />

  <div class="table">
    <label for="table1">Result:</label><br />
    <table id="table1" border="1" class="green_frame" style="width: 100%;">
    </table>
  </div>

</body>
</html>
