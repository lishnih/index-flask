{% extends "_layout.html" %}


{%- block head %}

  <script type="text/javascript">

    jQuery( function($) {


      // Share dialog
      $( "#dialog" ).dialog({
      	autoOpen: false,
      	width: 400,
      	buttons: [
      		{
      			text: "Ok",
      			click: function() {
      				$( this ).dialog( "close" );
      			}
      		},
      	]
      });


      $("table#table1 th").click(function( event ) {
        th = $(this);
        table = th.closest("table");

        var offset = table.data("offset");
        var limit = table.data("limit");
        var query = table.data("query");

        $( "#dialog #dialog_content" ).html("offset: {0}<br />limit: {1}<br />{2}".format(offset, limit, var_dump1(query)));
      	$( "#dialog" ).attr( "title", "info" );
      	$( "#dialog" ).dialog( "open" );
      	event.preventDefault();
      });


    } );

  </script>

{%- endblock %}


{%- block body %}

{%- from "_tablehelpers.html" import render_tr, render_tr_filter, render_tr_sorting, render_navigator %}

{%- if form %}
{%- if action %}
<form id="table_params" method="post" action="{{ action }}">
{%- else %}
<form id="table_params" method="post" action="#">
{%- endif %}

<div class="tabular">
  <div class="serial">
    <table border="1">
      <tr>
        <th colspan="2"><i>Вывод</i></th>
      </tr>
      {{ render_tr(form.offset) }}
      {{ render_tr(form.limit) }}
      <tr>
        <td></td>
        <td>{{ render_navigator(page, pages, filtered) }}</td>
      </tr>
    </table>
  </div>

  <div class="serial">
    <table border="1">
      <tr>
        <th colspan="3"><i>Фильтр</i>
          {%- if total %}
          <div class="right" style="font-weight: normal;"><i>Выведено {{ shown }} из {{ filtered }} (без фильтра {{ total }})</i></div>
          {%- endif %}
        </th>
      </tr>
      {{ render_tr_filter(form.column1, form.condition1, form.value1) }}
      {{ render_tr_filter(form.column2, form.condition2, form.value2) }}
      {{ render_tr_filter(form.column3, form.condition3, form.value3) }}
    </table>
  </div>

  <div class="serial">
    <table border="1">
      <tr>
        <th colspan="2"><i>Сортировка</i></th>
      </tr>
      {{ render_tr_sorting(form.sorting1, form.sort_dir1) }}
      {{ render_tr_sorting(form.sorting2, form.sort_dir2) }}
      {{ render_tr_sorting(form.sorting3, form.sort_dir3) }}
    </table>
  </div>

  {%- if templates_list %}
  <div class="serial">
    <table border="1">
      <tr>
        <th colspan="2"><i>Опции</i></th>
      </tr>
      {{ render_tr(form.template) }}
      {{ render_tr(form.unlim) }}
      {{ render_tr(form.plain) }}
    </table>
  </div>
  {%- endif %}
</div>


<div>
  <input type=submit value="Proceed">
</div>

</form>
{%- else %}
{%- if total %}
<div><i>Выведено {{ shown }} из {{ filtered }} (без фильтра {{ total }})</i></div>
{%- endif %}
{%- endif %}


<div class="table">
<table id="table1" border="1" data-offset="{{ offset }}" data-limit="{{ limit }}"
       data-query='{{ query_json }}'>
  <thead>
    {%- if names %}
    <tr>
      <th>#</th>
      {%- for name in names %}
      <th>{{ name }}</th>
      {%- endfor %}
    </tr>
    {%- endif %}
  </thead>

  <tbody>
    {%- if rows %}
    {%- for row in rows %}
    <tr>
      <td><i class="inactive">{{ loop.index }}</i></td>
      {%- autoescape false %}
      {%- for col in row %}
      {%- if col is none %}
      <td><i class="inactive">null<i></td>
      {%- else %}
      <td>{{ col }}</td>
      {%- endif %}
      {%- endfor %}
      {%- endautoescape %}
    </tr>
    {%- endfor %}


    {%- if colspan and limit and filtered > offset + limit %}
    <tr>
        <td class="a extendtable" colspan="{{ colspan+1 }}">
          Показать ещё {{ limit }} |
{%- if action %}
          <a href="{{ action }}&all">Показать всё</a>
{%- else %}
          <a href="?all">Показать всё</a>
{%- endif %}
        </td>
    </tr>
    {%- endif %}


    {%- endif %}
  </tbody>
</table>
{%- if not rows %}
<i>Нет данных</i>
{%- endif %}
</div>

<div id="dialog" title="Dialog">
  <div id="dialog_content"></div>
</div>

{%- endblock %}
